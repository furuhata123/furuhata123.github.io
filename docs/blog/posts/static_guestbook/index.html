<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8"/>
    <title>Serverless Guestbook on Static Site with Canvas</title>
    <link rel="stylesheet" href="/assets/blog-post.css">

    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-okaidia.min.css" rel="stylesheet"/>

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-ruby.min.js"></script>
    <link rel="stylesheet" href="/assets/markdown.css">

  </head>
  <body>
    <div class="wrapper">
      <aside class="sidebar">
        <a href="/blog/">
          <div class="serio" id="back-button">
            <span class="block-line">
              <span style="color:#00ff6b">←&nbsp;</span>
              <span>
                <span style="color:#2aff00">B</span>
                <span style="color:#ff9300">A</span>
                <span style="color:#c000ff">C</span>
                <span style="color:#ff00c7">K</span></span></span>
          </div>
        </a>
        
        <img src="/assets/blog/0110.png" alt="deco" style="display:block;margin:0 auto;">
      </aside>

      <main>
        <div id="post-header"></div>
        <a href="">Serverless Guestbook on Static Site with Canvas</a>
      </br>
      <small>
        2026-02-14
      </small>
      <div class="post-content">
        <p>The goal is to add a guestbook to my github page. The guestbook should include textareas of name and message, and an optional &quot;draw something&quot;.</p>
<p>The constraints were:</p>
<ul>
<li>No server</li>
<li>No database</li>
<li>Free</li>
<li>Customized</li>
<li>Deplyable to github pages</li>
<li>As simple as possible</li>
</ul>
<p>After several attempts, I ended up using <code>google form -&gt; google sheet -&gt; google app scripts.</code></p>
<h1>Initial Approach</h1>
<p>My initial approach was to build a netlify app, since netlify has built-in form, and I saw someone building a netlify guestbook with 11ty. The problem is netify and github are two different system, although you can iframe netlify app to gh page? but there could be many problems and I want to avoid iframe. The next idea was,<code>netlify -&gt; some automation service (zapire?) -&gt; github</code>. And this is where stupidity began. Since netlify form doesn't support json...</p>
<pre><code class="language-js">User
  ↓
Netlify Form
  ↓
Google Sheet (as database)
  ↓
Export to JSON
  ↓
GitHub Repository
  ↓
Static Build

</code></pre>
<p>...this is what I came up with. Note that two ends doesn't meet, so... efforts in vain, this happens when the process is too complicated. But it doesn't have to.</p>
<h1>Final Solution</h1>
<p>In fact, google has full support for data control. A google form can be linked to a google sheet, so everytime there's a new submit, google automatically updates the sheet. <a href="'https://mrinalcs.github.io/submit-html-form-to-google-form'">It can be super simple if you don't need much costumization.</a> Also there's a bulit-in script feature in google sheet where you can turn sheet into json file:</p>
<pre><code class="language-js">function doGet(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(&quot;Form Responses&quot;); 
  const data = sheet.getDataRange().getValues();

  const json = data.slice(1).map(row =&gt; ({
    timestamp: row[0],
    name: row[1],
    message: row[2],
  }));

  return ContentService
    .createTextOutput(JSON.stringify(json))
    .setMimeType(ContentService.MimeType.JSON);
}
// The script is a mock, and does not expose credentials or write access.
</code></pre>
<p>Then fetch in original repo with exec link. &lt;- should return a json. Rendering... and done.</p>
<h1>More features?</h1>
<p>I want more fun in this guestbook, so a drawing area would be fine. Also there was a stranger from netlify who left a random test image, a reply feature might be good since I lowkey want to thank them. And finally, there was a minor bug within drawing area, when a submit doesn't contain any drawing, there will still be a empty picture rendered, ugly and confusing.</p>
<h2>Draw!</h2>
<p>With HTML5 canvas api, a minimal drawing area was implemented.</p>
<pre><code class="language-js">const canvas = document.getElementById(&quot;draw&quot;);
const ctx = canvas.getContext(&quot;2d&quot;);
let drawing = false;

canvas.addEventListener(&quot;mousedown&quot;, () =&gt; drawing = true);
canvas.addEventListener(&quot;mouseup&quot;, () =&gt; drawing = false);
canvas.addEventListener(&quot;mousemove&quot;, e =&gt; {
    if (!drawing)
        return;
    const rect = canvas.getBoundingClientRect();
    ctx.fillStyle = &quot;#000&quot;;
    ctx.fillRect(e.clientX - rect.left, e.clientY - rect.top, 2, 2);
});
</code></pre>
<p>Basically we define a boolean <code>drawing</code>, which only ensures drawing when mousedown. During <code>mousemove</code>, the cursor position is translated from viewport coordinates to canvas coordinates using <code>getBoundingClientRect()</code>. Then renderes a 2*2 black rectangle.</p>
<h2>Blank image</h2>
<p>I use base64 to encode drawings. Base64 encoding does not embed semantic meaning, it merely represents binary data as ASCII characters. The browser determines how to interpret the decoded bytes based on the MIME type (<code>image/png</code>, <code>text/plain</code>, etc.) and the file format specification. In this setup, an empty canvas produces a deterministic PNG output in fixed size, which in turn results in a consistent Base64 string.</p>
<pre><code class="language-js">const knownEmptyDrawings = [xxxxx...];
</code></pre>
<p>By comparing image data and <code>knownEmptyDrawings</code>, we can determine whether it's a empty image.</p>
<h2>Reply</h2>
<p>It's not vital but I wanted to... so each message is mapped to a predefined response using a composite key in the format:
<code>name|message</code></p>
<pre><code class="language-js">const replies = {
  &quot;Test|test&quot;: &quot;Thank you for testing...&quot;
};
const key = `${msg.name}|${msg.message}`;
const reply = replies[key] ?? &quot;&quot;;
</code></pre>
<p>If a matching entry is found, a reply element is appended to the card.</p>
<h1>Final</h1>

      </div>
    </br>
    <p>Tags:
      &nbsp
      blog,Frontend
    </p>
  </main>

</div>
</body>
</html>